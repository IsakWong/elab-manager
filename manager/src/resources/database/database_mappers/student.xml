<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="student">
    <resultMap id="studentResultMap" type="student">
        <result column="学号" property="number"/>
        <result column="姓名" property="name"/>
        <result column="院系" property="college"/>
        <result column="理论课" property="theoryClass"/>
        <result column="硬件时间" property="hardTime"/>
        <result column="软件时间" property="softTime"/>
        <result column="硬件成绩" property="hardScore"/>
        <result column="软件成绩" property="softScore"/>
        <result column="试卷成绩" property="paperScore"/>
        <result column="邮箱" property="email"/>
        <result column="联系电话" property="tel"/>
        <result column="密码" property="pwd"/>
        <result column="补课" property="makeUpLessons"/>
        <result column="选课时间" property="courseSelectionTime"/>
        <result column="备注" property="remark"/>
    </resultMap>
    <resultMap id="rotaMap" type="rota">
        <result column="学号" property="number"/>
        <result column="姓名" property="name"/>
        <result column="组别" property="group"/>
        <result column="时段" property="time"/>
        <result column="单双周" property="week"/>
        <result column="星期" property="day"/>
    </resultMap>
    <resultMap id="loaderMap" type="loader">
        <result column="学号" property="number"/>
        <result column="姓名" property="name"/>
        <result column="组别" property="group"/>
        <result column="日期" property="date"/>
        <result column="周次" property="week"/>
        <result column="登入" property="login"/>
        <result column="离开" property="logout"/>
        <result column="合计时间" property="totalTime"/>
        <result column="学期" property="term"/>
    </resultMap>
    <select id="selectStudentByName" parameterType="string" resultMap="studentResultMap">
        select * from 2018秋_计算机安装与调试技术 where 姓名 like #{id} '%'
    </select>
    <select id="selectStudentByNumber" parameterType="string" resultMap="studentResultMap">
        select * from 2018秋_计算机安装与调试技术 where 学号 like #{id} '%'
    </select>
    <select id="selectStudentByCollege" parameterType="string" resultMap="studentResultMap">
        select * from 2018秋_计算机安装与调试技术 where 院系 like #{id} '%'
    </select>
    <select id="selectSchoolOpeningDate" resultType="schoolOpen">
        select
            开学日期 as "schoolOpeningDate",
            学期 as "term",
            硬件理论 as "hardTheory",
            软件理论 as "softTheory",
            硬件周次 as "hardWeeks",
            软件周次 as "softWeeks",
            关闭选课 as "closeChooseClasses",
            值班形式 as "onDutyForm",
            课容量 as "classCapacity"
        from 开学日期
    </select>
    <select id="selectRota" resultMap="rotaMap">
        select * from duty
    </select>
    <select id="selectLoader" parameterType="String" resultMap="loaderMap">
        select * from 时间统计 where 日期 = #{id}
    </select>
    <select id="selectAllLogs" parameterType="String" resultType="log">
        select
            ID as "ID",
            操作时间 as "time",
            操作人IP as "IP",
            硬件成绩 as "hardScore",
            软件成绩 as "softScore",
            试卷成绩 as "paperScore",
            登录信息 as "information",
            版本号 as "version",
        concat("\t", 操作人学号) as "operatingNumber",
        concat("\t", 被修改人学号) as "operatedNumber"
        from Log where 学期 = #{id}
    </select>
    <select id="selectAllFreeTime" parameterType="String" resultType="freeTime">
        select
            学号 as "number",
            姓名 as "name"
        from 空闲时间统计 where 学期 = #{id}
    </select>
    <insert id="insertFreeTime" parameterType="freeTime">
        insert into 空闲时间统计 (ID,学号,姓名,信息,学期,备注,修改日期)
        values(#{ID},#{number},#{name},#{freeTime},#{term},#{remarks},#{modificationDate})
    </insert>
    <insert id="writeLog" parameterType="log">
        insert into Log (ID,操作人学号,操作时间,操作人IP,被修改人学号,硬件成绩,软件成绩,试卷成绩,登录信息,版本号,学期)
        values(#{ID},#{operatingNumber},#{time},#{IP},#{operatedNumber},#{hardScore},#{softScore},#{paperScore},#{information},#{version},#{term})
    </insert>
    <update id="updateScore" parameterType="student">
        update 2018秋_计算机安装与调试技术 set
            硬件成绩 = #{hardScore},
            软件成绩 = #{softScore},
            试卷成绩 = #{paperScore}
        where 学号 = #{number}
    </update>
</mapper>